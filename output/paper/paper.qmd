---
title: "House price"
author: "Yufei Liu"
thanks: "Code and data are available at: https://github.com/Florence-Liu/house-price"
date: today
date-format: long
abstract: "."
format: pdf
number-sections: true
toc: false
bibliography: references.bib
---


# Introduction

Since the population in China has grown a lot in recent years.

# Data


```{r}
#| echo: false
#| message: false
#| warning: false


#### Workspace setup ####
library(tidyverse)
library(knitr)
library(here)
library(randomForest)

#### Read in the cleaned data ####
data <- read_csv(here("output/data/cleaned_data.csv"), 
                 show_col_types = FALSE)

#### Split training and testing sets ####
set.seed(777)
trainid <- sample(nrow(data), 0.8*nrow(data))
train <- data[trainid,]
test <- data[-trainid,]
```


```{r}
#| label: tbl-data
#| fig-cap: Description for variables
#| echo: false
#| message: false
#| warning: false

var <- c("Total_Price", "Unit_Price", "District", "Area", "Furnished", "Bedroom", "Living_Room", "Total_Floors", "Detailed_Floor", "Facing_South")
type <- c("Continuous", "Continuous", "Character", "Continuous", "Character", "Continuous", "Continuous", "Continuous", "Continuous", "Dummy")
def <- c("Total house price in yuan", "Unit house price in yuan/$m^2$", "District where the house is located", "Floor area of the house in $m^2$ ", "Decoration status of the house", "Number of bedrooms", "Number of living/dining rooms", "Total height in floor of the building", "Floor level of the house", "Whether the house is facing south")
kable(data.frame(var, type, def), col.names = c("Variable", "Type", "Definition"))
```


```{r}
#| label: tbl-price
#| fig-cap: Description for variables
#| echo: false
#| message: false
#| warning: false

data |> group_by(District) |>
  summarise(avg_total = round(mean(Total_Price)), 
            avg_unit = round(mean(Unit_Price))) |>
  kable(col.names = c("District","Average total price","Average unit price"))
```


```{r}
#| label: fig-price
#| echo: false
#| message: false
#| warning: false

data |>
  ggplot(aes(x = as.factor(Facing_South), y = Total_Price)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal()
```



# Model

```{r}
#| echo: false
#| warning: false
#| message: false
#| include: false

model_mlg <- lm(Total_Price ~., data = train)
summary(model_mlg)
predict_mlg <- predict(model_mlg, newdata = test)
mean((test$Total_Price-predict_mlg)^2)
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| include: false

model_rf <- randomForest(Total_Price ~., data=train)
model_rf
predict_rf <- predict(model_rf, newdata = test)
mean((test$Total_Price-predict_rf)^2)

varImpPlot(model_rf)
```

# Result


# Discussion


\newpage
# Reference